<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador de Entrevistas IA</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .title {
            font-size: 2.5em;
            margin-bottom: 10px;
            color: #333;
        }

        .subtitle {
            color: #666;
            font-size: 1.1em;
        }

        .setup-screen {
            background: white;
            border-radius: 10px;
            padding: 40px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .chat-interface {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: none;
            flex-direction: column;
            height: 600px;
        }

        .chat-header {
            padding: 20px;
            border-bottom: 1px solid #eee;
            background: #f8f9fa;
            border-radius: 10px 10px 0 0;
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .message {
            display: flex;
            gap: 15px;
            max-width: 80%;
        }

        .message.user {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            flex-shrink: 0;
            font-size: 14px;
        }

        .message.ai .message-avatar {
            background: #007bff;
        }

        .message.user .message-avatar {
            background: #28a745;
        }

        .message-content {
            background: #f8f9fa;
            padding: 15px 20px;
            border-radius: 10px;
            border: 1px solid #e9ecef;
            line-height: 1.5;
        }

        .message.user .message-content {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }

        .chat-input {
            padding: 20px;
            border-top: 1px solid #eee;
            background: #f8f9fa;
            border-radius: 0 0 10px 10px;
            display: flex;
            gap: 15px;
        }

        .input-field {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid #ddd;
            border-radius: 5px;
            outline: none;
            font-size: 16px;
        }

        .input-field:focus {
            border-color: #007bff;
        }

        .send-btn {
            padding: 12px 24px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }

        .send-btn:hover:not(:disabled) {
            background: #0056b3;
        }

        .send-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .api-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            margin-bottom: 20px;
            outline: none;
        }

        .api-input:focus {
            border-color: #007bff;
        }

        .start-btn {
            padding: 15px 40px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
        }

        .start-btn:hover {
            background: #0056b3;
        }

        .instructions {
            text-align: left;
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 5px;
            font-size: 14px;
            line-height: 1.6;
        }

        .loading {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #666;
            font-style: italic;
        }

        .interview-stats {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 15px;
            border-radius: 5px;
            font-size: 14px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: none;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="interview-stats" id="stats">
        <div>Pregunta: <span id="questionCount">0</span>/10</div>
        <div>Tipo: <span id="questionType">Preparando...</span></div>
    </div>

    <div class="container">
        <div class="header">
            <h1 class="title">Simulador de Entrevistas IA</h1>
            <p class="subtitle">Practica para tu entrevista con inteligencia artificial</p>
        </div>

        <div class="setup-screen" id="setupScreen">
            <h2>Configuración</h2>
            <div class="instructions">
                <h3>Instrucciones:</h3>
                <ul>
                    <li>Necesitas una API Key de Google AI Studio (Gemini)</li>
                    <li>La IA actuará como un entrevistador técnico</li>
                    <li>Recibirás preguntas técnicas y conductuales</li>
                    <li>Responde de manera detallada y profesional</li>
                </ul>
                <p><strong>Obtén tu API Key:</strong> <a href="https://aistudio.google.com/" target="_blank">Google AI Studio</a></p>
            </div>
            
            <input 
                type="password" 
                class="api-input" 
                id="apiKeyInput" 
                placeholder="Ingresa tu API Key de Google AI Studio..."
            >
            
            <button class="start-btn" onclick="startInterview()">
                Comenzar Entrevista
            </button>
            
            <div id="errorContainer"></div>
        </div>

        <div class="chat-interface" id="chatInterface">
            <div class="chat-header">
                <h3>Entrevistador IA</h3>
                <p>Simulando entrevista técnica</p>
            </div>
            
            <div class="chat-messages" id="chatMessages"></div>
            
            <div class="chat-input">
                <input 
                    type="text" 
                    class="input-field" 
                    id="messageInput" 
                    placeholder="Escribe tu respuesta..."
                >
                <button class="send-btn" id="sendBtn" onclick="sendMessage()">
                    Enviar
                </button>
            </div>
        </div>
    </div>

    <script>
        const PREDEFINED_QUESTIONS = [
            "Cuéntame sobre ti y tu experiencia en desarrollo.",
            "¿Cómo optimizarías una consulta SQL lenta?",
            "Explica las diferencias entre REST y GraphQL.",
            "¿Cómo manejarías el escalado de una aplicación web?",
            "Describe el algoritmo de búsqueda binaria.",
            "¿Cómo implementarías un sistema de cache?",
            "Explica los principios SOLID de programación.",
            "¿Cómo resuelves conflictos en un equipo?",
            "Describe un proyecto desafiante que hayas completado.",
            "¿Qué harías si un sistema falla en producción?",
            "¿Cómo mantienes la seguridad en una aplicación web?",
            "Explica la diferencia entre SQL y NoSQL.",
            "¿Cómo implementarías autenticación en una API?",
            "Describe tu experiencia con control de versiones.",
            "¿Cómo evalúas la calidad de tu código?"
        ];

        let apiKey = '';
        let questionCount = 0;
        let conversationHistory = [];
        let usedQuestions = new Set();

        async function startInterview() {
            apiKey = document.getElementById('apiKeyInput').value.trim();
            
            if (!apiKey) {
                showError('Por favor, ingresa tu API Key de Google AI Studio');
                return;
            }

            // Probar la API key
            try {
                await testApiKey();
                document.getElementById('setupScreen').style.display = 'none';
                document.getElementById('chatInterface').style.display = 'flex';
                document.getElementById('stats').style.display = 'block';

                await addMessage('ai', 'Hola! Soy tu entrevistador virtual. Vamos a realizar una entrevista técnica simulada. ¿Estás listo para comenzar?');
                
                setTimeout(() => askNextQuestion(), 2000);
            } catch (error) {
                showError('Error con la API Key. Verifica que sea correcta y tenga permisos.');
            }
        }

        async function testApiKey() {
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{
                        parts: [{ text: "Hola" }]
                    }]
                })
            });

            if (!response.ok) {
                throw new Error('API Key inválida');
            }
        }

        function showError(message) {
            const errorContainer = document.getElementById('errorContainer');
            errorContainer.innerHTML = `<div class="error-message">${message}</div>`;
        }

        async function askNextQuestion() {
            if (questionCount >= 10) {
                await endInterview();
                return;
            }

            questionCount++;
            updateStats('Generando pregunta...');

            const shouldUsePredefined = Math.random() < 0.5 || questionCount === 1;
            let question;

            if (shouldUsePredefined) {
                question = getRandomPredefinedQuestion();
                updateStats('Pregunta estándar');
            } else {
                question = await generateDynamicQuestion();
                updateStats('Pregunta personalizada');
            }

            if (question) {
                await addMessage('ai', question);
            }
        }

        function getRandomPredefinedQuestion() {
            const availableQuestions = PREDEFINED_QUESTIONS.filter(q => !usedQuestions.has(q));
            if (availableQuestions.length === 0) return PREDEFINED_QUESTIONS[0];
            
            const selected = availableQuestions[Math.floor(Math.random() * availableQuestions.length)];
            usedQuestions.add(selected);
            return selected;
        }

        async function generateDynamicQuestion() {
            const recentHistory = conversationHistory.slice(-4).map(msg => `${msg.sender}: ${msg.content}`).join('\n');
            
            const prompt = `Eres un entrevistador técnico experimentado. Basándote en esta conversación, genera UNA pregunta técnica o conductual apropiada para evaluar al candidato. La pregunta debe ser diferente a las anteriores.

Conversación reciente:
${recentHistory}

Genera solo la pregunta:`;

            try {
                const response = await callGeminiAPI(prompt);
                return response || getRandomPredefinedQuestion();
            } catch (error) {
                console.error('Error generando pregunta:', error);
                return getRandomPredefinedQuestion();
            }
        }

        async function callGeminiAPI(prompt) {
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{
                        parts: [{ text: prompt }]
                    }]
                })
            });

            if (!response.ok) throw new Error(`API Error: ${response.status}`);
            
            const data = await response.json();
            return data.candidates?.[0]?.content?.parts?.[0]?.text?.trim();
        }

        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message) return;

            input.value = '';
            document.getElementById('sendBtn').disabled = true;

            await addMessage('user', message);
            
            await showTyping();
            
            setTimeout(() => {
                askNextQuestion();
                document.getElementById('sendBtn').disabled = false;
            }, 1500);
        }

        async function addMessage(type, content) {
            const messagesContainer = document.getElementById('chatMessages');
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            
            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.textContent = type === 'ai' ? 'IA' : 'TU';
            
            const messageContent = document.createElement('div');
            messageContent.className = 'message-content';
            messageContent.textContent = content;
            
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(messageContent);
            messagesContainer.appendChild(messageDiv);
            
            conversationHistory.push({ sender: type, content });
            
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        async function showTyping() {
            const messagesContainer = document.getElementById('chatMessages');
            
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message ai';
            typingDiv.id = 'typing-indicator';
            
            typingDiv.innerHTML = `
                <div class="message-avatar">IA</div>
                <div class="message-content">
                    <div class="loading">Analizando respuesta...</div>
                </div>
            `;
            
            messagesContainer.appendChild(typingDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            return new Promise(resolve => {
                setTimeout(() => {
                    typingDiv.remove();
                    resolve();
                }, 1000);
            });
        }

        async function endInterview() {
            updateStats('Entrevista completada');
            
            const finalMessage = `Excelente! Hemos completado la entrevista. 

Resumen:
- Preguntas respondidas: ${questionCount}
- Has demostrado buenos conocimientos técnicos
- Tu comunicación fue clara y profesional

Gracias por participar en esta simulación de entrevista!`;

            await addMessage('ai', finalMessage);
            
            document.getElementById('sendBtn').style.display = 'none';
            document.getElementById('messageInput').disabled = true;
            document.getElementById('messageInput').placeholder = 'Entrevista completada';
        }

        function updateStats(questionType) {
            document.getElementById('questionCount').textContent = questionCount;
            document.getElementById('questionType').textContent = questionType;
        }

        document.getElementById('messageInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });
    </script>
</body>
</html>
